/*jshint esversion: 6 */
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Scaling {
    constructor() {
        this.Client = require('node-rest-client').Client;
        this.client = new this.Client();
        this.scaling_host = process.env.SCALING_HOST || 'localhost';
        this.component = {};
        this.status = {
            message: 'not updated yet',
            statusCode: 500
        };
        this.virtualmachines = [];
    }
    start_updates(interval) {
        this.update_status(interval);
        this.update_virtualmachines(10 * interval);
    }
    update_status(interval) {
        const req = this.client.get('http://' + this.scaling_host + ':8888/status', (data, response) => {
            this.status.statusCode = response.statusCode;
            this.status.message = response.statusMessage;
            setTimeout(() => this.update_status(interval), interval);
        });
        req.on('error', (error) => {
            this.status.statusCode = 500;
            this.status.message = error.code;
            setTimeout(() => this.update_status(interval), interval);
        });
    }
    update_virtualmachines(interval) {
        const req = this.client.get('http://' + this.scaling_host + ':8888/virtualmachines', (data, response) => {
            this.virtualmachines = data;
            setTimeout(() => this.update_virtualmachines(interval), interval);
        });
        req.on('error', (error) => {
            console.log(error);
            this.status.statusCode = 500;
            this.status.message = error.code;
            setTimeout(() => this.update_virtualmachines(interval), interval);
        });
    }
    check_status() {
        return this.status;
    }
    ;
    get_virtualmachines() {
        return this.virtualmachines;
    }
    ;
    start_virtualmachine(resourcegroup, machine_id, cb) {
        const req = this.client.post('http://' + this.scaling_host + ':8888/virtualmachines/' + resourcegroup + '/' + machine_id, (data, response) => {
            if (response.statusCode === 200) {
                cb(null, data);
            }
            else {
                cb('Error: ' + data, null);
            }
        });
        req.on('error', (error) => {
            cb('error: ' + error, null);
        });
    }
    ;
    stop_virtualmachine(resourcegroup, machine_id, cb) {
        const req = this.client.delete('http://' + this.scaling_host + ':8888/virtualmachines/' + resourcegroup + '/' + machine_id, (data, response) => {
            if (response.statusCode === 200) {
                cb(null, data);
            }
            else {
                cb('Error: ' + data, null);
            }
        });
        req.on('error', (error) => {
            cb('error: ' + error, null);
        });
    }
    ;
}
exports.Scaling = Scaling;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRzL3NjYWxpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsd0JBQXdCOzs7QUFFeEI7SUFBQTtRQUNJLFdBQU0sR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDNUMsV0FBTSxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzNCLGlCQUFZLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLElBQUksV0FBVyxDQUFDO1FBQ3ZELGNBQVMsR0FBRyxFQUFFLENBQUM7UUFDZixXQUFNLEdBQUc7WUFDTCxPQUFPLEVBQUUsaUJBQWlCO1lBQzFCLFVBQVUsRUFBRSxHQUFHO1NBQ2xCLENBQUM7UUFDRixvQkFBZSxHQUFVLEVBQUUsQ0FBQztJQTZFaEMsQ0FBQztJQTNFRyxhQUFhLENBQUMsUUFBYTtRQUN2QixJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVELGFBQWEsQ0FBQyxRQUFhO1FBQ3ZCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxHQUFHLGNBQWMsRUFDdEUsQ0FBQyxJQUFTLEVBQUUsUUFBYTtZQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUMsVUFBVSxDQUFDO1lBQzdDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUM7WUFFN0MsVUFBVSxDQUFDLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUMsQ0FBQztRQUVQLEdBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBVTtZ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QyxDQUFDO1lBQy9CLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVQLEdBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBVTtZQUN2QixFQUFFLENBQUMsU0FBUyxHQUFHLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFBQSxDQUFDO0NBQ0w7QUF0RkQsMEJBc0ZDIiwiZmlsZSI6InNyYy9jb21wb25lbnRzL3NjYWxpbmcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKmpzaGludCBlc3ZlcnNpb246IDYgKi9cclxuXHJcbmV4cG9ydCBjbGFzcyBTY2FsaW5nIHtcclxuICAgIENsaWVudCA9IHJlcXVpcmUoJ25vZGUtcmVzdC1jbGllbnQnKS5DbGllbnQ7XHJcbiAgICBjbGllbnQgPSBuZXcgdGhpcy5DbGllbnQoKTtcclxuICAgIHNjYWxpbmdfaG9zdCA9IHByb2Nlc3MuZW52LlNDQUxJTkdfSE9TVCB8fCAnbG9jYWxob3N0JztcclxuICAgIGNvbXBvbmVudCA9IHt9O1xyXG4gICAgc3RhdHVzID0ge1xyXG4gICAgICAgIG1lc3NhZ2U6ICdub3QgdXBkYXRlZCB5ZXQnLFxyXG4gICAgICAgIHN0YXR1c0NvZGU6IDUwMFxyXG4gICAgfTtcclxuICAgIHZpcnR1YWxtYWNoaW5lczogYW55W10gPSBbXTtcclxuXHJcbiAgICBzdGFydF91cGRhdGVzKGludGVydmFsOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZV9zdGF0dXMoaW50ZXJ2YWwpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlX3ZpcnR1YWxtYWNoaW5lcygxMCAqIGludGVydmFsKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVfc3RhdHVzKGludGVydmFsOiBhbnkpIHtcclxuICAgICAgICBjb25zdCByZXEgPSB0aGlzLmNsaWVudC5nZXQoJ2h0dHA6Ly8nICsgdGhpcy5zY2FsaW5nX2hvc3QgKyAnOjg4ODgvc3RhdHVzJyxcclxuICAgICAgICAgICAgKGRhdGE6IGFueSwgcmVzcG9uc2U6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMuc3RhdHVzQ29kZSA9IHJlc3BvbnNlLnN0YXR1c0NvZGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cy5tZXNzYWdlID0gcmVzcG9uc2Uuc3RhdHVzTWVzc2FnZTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMudXBkYXRlX3N0YXR1cyhpbnRlcnZhbCksIGludGVydmFsKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlcS5vbignZXJyb3InLCAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1cy5zdGF0dXNDb2RlID0gNTAwO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1cy5tZXNzYWdlID0gZXJyb3IuY29kZTtcclxuXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy51cGRhdGVfc3RhdHVzKGludGVydmFsKSwgaW50ZXJ2YWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZV92aXJ0dWFsbWFjaGluZXMoaW50ZXJ2YWw6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHJlcSA9IHRoaXMuY2xpZW50LmdldCgnaHR0cDovLycgKyB0aGlzLnNjYWxpbmdfaG9zdCArICc6ODg4OC92aXJ0dWFsbWFjaGluZXMnLFxyXG4gICAgICAgICAgICAoZGF0YTogYW55LCByZXNwb25zZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpcnR1YWxtYWNoaW5lcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMudXBkYXRlX3ZpcnR1YWxtYWNoaW5lcyhpbnRlcnZhbCksIGludGVydmFsKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlcS5vbignZXJyb3InLCAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzLnN0YXR1c0NvZGUgPSA1MDA7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzLm1lc3NhZ2UgPSBlcnJvci5jb2RlO1xyXG5cclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnVwZGF0ZV92aXJ0dWFsbWFjaGluZXMoaW50ZXJ2YWwpLCBpbnRlcnZhbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tfc3RhdHVzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN0YXR1cztcclxuICAgIH07XHJcblxyXG4gICAgZ2V0X3ZpcnR1YWxtYWNoaW5lcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52aXJ0dWFsbWFjaGluZXM7XHJcbiAgICB9O1xyXG5cclxuICAgIHN0YXJ0X3ZpcnR1YWxtYWNoaW5lKHJlc291cmNlZ3JvdXA6IGFueSwgbWFjaGluZV9pZDogYW55LCBjYjogYW55KSB7XHJcbiAgICAgICAgY29uc3QgcmVxID0gdGhpcy5jbGllbnQucG9zdCgnaHR0cDovLycgKyB0aGlzLnNjYWxpbmdfaG9zdCArICc6ODg4OC92aXJ0dWFsbWFjaGluZXMvJyArIHJlc291cmNlZ3JvdXAgKyAnLycgKyBtYWNoaW5lX2lkLFxyXG4gICAgICAgICAgICAoZGF0YTogYW55LCByZXNwb25zZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2IobnVsbCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKCdFcnJvcjogJyArIGRhdGEsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVxLm9uKCdlcnJvcicsIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGNiKCdlcnJvcjogJyArIGVycm9yLCBudWxsKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgc3RvcF92aXJ0dWFsbWFjaGluZShyZXNvdXJjZWdyb3VwOiBhbnksIG1hY2hpbmVfaWQ6IGFueSwgY2I6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHJlcSA9IHRoaXMuY2xpZW50LmRlbGV0ZSgnaHR0cDovLycgKyB0aGlzLnNjYWxpbmdfaG9zdCArICc6ODg4OC92aXJ0dWFsbWFjaGluZXMvJyArIHJlc291cmNlZ3JvdXAgKyAnLycgKyBtYWNoaW5lX2lkLFxyXG4gICAgICAgICAgICAoZGF0YTogYW55LCByZXNwb25zZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2IobnVsbCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKCdFcnJvcjogJyArIGRhdGEsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVxLm9uKCdlcnJvcicsIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGNiKCdlcnJvcjogJyArIGVycm9yLCBudWxsKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbn1cclxuIl19
