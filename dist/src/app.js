"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/*jshint esversion: 6 */
require("source-map-support/register");
const express = require('express'), app = express();
const bodyParser = require('body-parser');
app.use(bodyParser.json());
const server = require('http').createServer(app);
const workflows_1 = require("./components/workflows");
const workflows = new workflows_1.Workflow();
const redis_1 = require("./components/redis");
const redis = new redis_1.Redis();
const docker_1 = require("./components/docker");
const docker = new docker_1.Docker();
const human_1 = require("./components/human");
const human = new human_1.Human();
const scaling_1 = require("./components/scaling");
const scaling = new scaling_1.Scaling();
const scheduler_1 = require("./components/scheduler");
const scheduler = new scheduler_1.Scheduler();
const elastic_1 = require("./components/elastic");
const elastic = new elastic_1.Elastic();
const os = require('os');
const log4js = require('log4js');
log4js.configure({
    appenders: [
        { type: 'console' },
        {
            host: '137.116.195.67',
            port: 12201,
            type: 'gelf',
            hostname: 'elastic-dashboard-api@' + os.hostname(),
            layout: {
                type: 'pattern',
                pattern: '%m'
            },
            category: ['console']
        }
    ],
    replaceConsole: true
});
const return_status = function (status, req, res) {
    res.setHeader('Content-Type', 'application/json');
    res.status(status.statusCode).send(status.message);
};
const return_json = function (json, req, res) {
    res.setHeader('Content-Type', 'application/json');
    res.send(JSON.stringify(json, null, 2));
};
const create_workflows_from_file = function (req, res) {
    workflows.create_workflows_from_file(req, (error, data) => {
        if (error) {
            res.status(500).send(error);
        }
        else {
            console.log(data);
            res.send(JSON.stringify(data, null, 2));
        }
        ;
    });
};
const delete_workflow = function (req, res) {
    workflows.delete_workflow(req.params['workflow_id'], (error, data) => {
        if (error) {
            res.status(500).send(error);
        }
        else {
            res.send(JSON.stringify(data, null, 2));
        }
        ;
    });
};
const set_node_availability = function (req, res) {
    docker.set_node_availability(req.params['hostname'], req.params['availability'], (error, data) => {
        if (error) {
            res.status(500).send(error);
        }
        else {
            res.send(JSON.stringify(data, null, 2));
        }
        ;
    });
};
const start_virtualmachine = function (req, res) {
    scaling.start_virtualmachine(req.params['resourcegroup'], req.params['machine_id'], (error, data) => {
        if (error) {
            res.status(500).send(error);
        }
        else {
            res.send(JSON.stringify(data, null, 2));
        }
        ;
    });
};
const stop_virtualmachine = function (req, res) {
    scaling.stop_virtualmachine(req.params['resourcegroup'], req.params['machine_id'], (error, data) => {
        if (error) {
            res.status(500).send(error);
        }
        else {
            res.send(JSON.stringify(data, null, 2));
        }
        ;
    });
};
// ROUTING
const setup_routes = function () {
    app.get('/api/redis/status', (req, res) => return_status(redis.check_status(), req, res));
    app.get('/api/workflow/status', (req, res) => return_status(workflows.check_status(), req, res));
    app.get('/api/workflow/workflows', (req, res) => return_json(workflows.get_workflows(), req, res));
    app.post('/api/workflow/workflows', (req, res) => return_json(workflows.create_workflow(req.body), req, res));
    app.delete('/api/workflow/workflows', (req, res) => return_json_post(workflows.delete_all_workflows, req, res));
    app.delete('/api/workflow/workflows/:workflow_id', (req, res) => delete_workflow(req, res));
    app.post('/api/workflow/workflows/file', (req, res) => create_workflows_from_file(req, res));
    app.get('/api/docker/status', (req, res) => return_status(docker.check_status(), req, res));
    app.get('/api/docker/info/remote', (req, res) => return_json(docker.get_remote_info(), req, res));
    app.get('/api/docker/containers/remote', (req, res) => return_json(docker.get_remote_containers(), req, res));
    app.get('/api/docker/services/remote', (req, res) => return_json(docker.get_remote_services(), req, res));
    app.post('/api/docker/services/workers', (req, res) => return_json_post(docker.create_workers, req, res));
    app.delete('/api/docker/services/workers', (req, res) => return_json_post(docker.delete_workers, req, res));
    app.get('/api/docker/nodes', (req, res) => return_json(docker.get_nodes(), req, res));
    app.post('/api/docker/nodes/:hostname/:availability', set_node_availability);
    app.get('/api/docker/workers', (req, res) => return_json(docker.get_workers(), req, res));
    app.get('/api/human/status', (req, res) => return_status(human.check_status(), req, res));
    app.get('/api/human/info', (req, res) => return_json(human.get_info(), req, res));
    app.post('/api/human/start', (req, res) => return_json_post(human.start_humans, req, res));
    app.post('/api/human/stop', (req, res) => return_json_post(human.stop_humans, req, res));
    app.get('/api/scaling/status', (req, res) => return_status(scaling.check_status(), req, res));
    app.get('/api/scaling/virtualmachines', (req, res) => return_json(scaling.get_virtualmachines(), req, res));
    app.post('/api/scaling/virtualmachines/:resourcegroup/:machine_id/start', start_virtualmachine);
    app.post('/api/scaling/virtualmachines/:resourcegroup/:machine_id/stop', stop_virtualmachine);
    app.get('/api/scheduler/status', (req, res) => return_status(scheduler.check_status(), req, res));
    app.get('/api/scheduler/info', (req, res) => return_json(scheduler.get_info(), req, res));
    app.get('/api/scheduler/tasks/human', (req, res) => return_json(scheduler.get_human_tasks(), req, res));
    app.post('/api/scheduler/task', (req, res) => return_json_post(scheduler.set_human_task, req, res));
    app.post('/api/scheduler/policy', (req, res) => return_json(scheduler.set_policy(req.body), req, res));
    app.post('/api/scheduler/amount', (req, res) => return_json_post(scheduler.set_amount, req, res));
    app.post('/api/scheduler/execute', (req, res) => return_json_post(scheduler.execute, req, res));
    app.get('/api/elastic/status', (req, res) => return_status(elastic.check_status(), req, res));
    app.get('/api/elastic/logs', (req, res) => return_json(elastic.get_messages(), req, res));
    app.get('/api/elastic/load', (req, res) => return_json(elastic.get_load(), req, res));
};
const start_check_status = function () {
    redis.update_status(2000);
    scheduler.start_updates(2000);
    workflows.start_updates(2000);
    docker.start_updates(10000); // 10sec for docker
    human.start_updates(2000);
    scaling.start_updates(2000);
    elastic.start_updates(2000);
};
// Server startup
const start_server = function () {
    server.listen(8080, () => console.log('Elastic-dashboard-api listening on port 8080!'));
};
// When run directly, serve the API
if (require.main === module) {
    setup_routes();
    start_server();
    start_check_status();
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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R0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xCLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUMsQ0FBQztRQUFBLENBQUM7SUFDTixDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQztBQUVGLE1BQU0sZUFBZSxHQUFHLFVBQVUsR0FBUSxFQUFFLEdBQVE7SUFDaEQsU0FBUyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsS0FBVSxFQUFFLElBQVM7UUFDdkUsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNSLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUMsQ0FBQztRQUFBLENBQUM7SUFDTixDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQztBQUVGLE1BQU0scUJBQXFCLEdBQUcsVUFBVSxHQUFRLEVBQUUsR0FBUTtJQUN0RCxNQUFNLENBQUMscUJBQXFCLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsS0FBVSxFQUFFLElBQVM7UUFDbkcsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNSLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNB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SUFBSSxDQUFDLENBQUM7SUFDNUIsT0FBTyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoQyxDQUFDLENBQUM7QUFFRixpQkFBaUI7QUFDakIsTUFBTSxZQUFZLEdBQUc7SUFDakIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLCtDQUErQyxDQUFDLENBQUMsQ0FBQztBQUM1RixDQUFDLENBQUM7QUFFRixtQ0FBbUM7QUFDbkMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQzFCLFlBQVksRUFBRSxDQUFDO0lBQ2YsWUFBWSxFQUFFLENBQUM7SUFDZixrQkFBa0IsRUFBRSxDQUFDO0FBQ3pCLENBQUMiLCJmaWxlIjoic3JjL2FwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qanNoaW50IGVzdmVyc2lvbjogNiAqL1xyXG5pbXBvcnQgJ3NvdXJjZS1tYXAtc3VwcG9ydC9yZWdpc3Rlcic7XHJcbmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyksXHJcbiAgICBhcHAgPSBleHByZXNzKCk7XHJcblxyXG5jb25zdCBib2R5UGFyc2VyID0gcmVxdWlyZSgnYm9keS1wYXJzZXInKTtcclxuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSk7XHJcblxyXG5jb25zdCBzZXJ2ZXIgPSByZXF1aXJlKCdodHRwJykuY3JlYXRlU2VydmVyKGFwcCk7XHJcblxyXG5pbXBvcnQgeyBXb3JrZmxvdyB9IGZyb20gJy4vY29tcG9uZW50cy93b3JrZmxvd3MnO1xyXG5jb25zdCB3b3JrZmxvd3MgPSBuZXcgV29ya2Zsb3coKTtcclxuXHJcbmltcG9ydCB7IFJlZGlzIH0gZnJvbSAnLi9jb21wb25lbnRzL3JlZGlzJztcclxuY29uc3QgcmVkaXMgPSBuZXcgUmVkaXMoKTtcclxuXHJcbmltcG9ydCB7IERvY2tlciB9IGZyb20gJy4vY29tcG9uZW50cy9kb2NrZXInO1xyXG5jb25zdCBkb2NrZXIgPSBuZXcgRG9ja2VyKCk7XHJcblxyXG5pbXBvcnQgeyBIdW1hbiB9IGZyb20gJy4vY29tcG9uZW50cy9odW1hbic7XHJcbmNvbnN0IGh1bWFuID0gbmV3IEh1bWFuKCk7XHJcblxyXG5pbXBvcnQgeyBTY2FsaW5nIH0gZnJvbSAnLi9jb21wb25lbnRzL3NjYWxpbmcnO1xyXG5jb25zdCBzY2FsaW5nID0gbmV3IFNjYWxpbmcoKTtcclxuXHJcbmltcG9ydCB7IFNjaGVkdWxlciB9IGZyb20gJy4vY29tcG9uZW50cy9zY2hlZHVsZXInO1xyXG5jb25zdCBzY2hlZHVsZXIgPSBuZXcgU2NoZWR1bGVyKCk7XHJcblxyXG5pbXBvcnQgeyBFbGFzdGljIH0gZnJvbSAnLi9jb21wb25lbnRzL2VsYXN0aWMnO1xyXG5jb25zdCBlbGFzdGljID0gbmV3IEVsYXN0aWMoKTtcclxuXHJcbmNvbnN0IG9zID0gcmVxdWlyZSgnb3MnKTtcclxuY29uc3QgbG9nNGpzID0gcmVxdWlyZSgnbG9nNGpzJyk7XHJcbmxvZzRqcy5jb25maWd1cmUoe1xyXG4gICAgYXBwZW5kZXJzOiBbXHJcbiAgICAgICAgeyB0eXBlOiAnY29uc29sZScgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGhvc3Q6ICcxMzcuMTE2LjE5NS42NycsXHJcbiAgICAgICAgICAgIHBvcnQ6IDEyMjAxLFxyXG4gICAgICAgICAgICB0eXBlOiAnZ2VsZicsXHJcbiAgICAgICAgICAgIGhvc3RuYW1lOiAnZWxhc3RpYy1kYXNoYm9hcmQtYXBpQCcgKyBvcy5ob3N0bmFtZSgpLFxyXG4gICAgICAgICAgICBsYXlvdXQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdwYXR0ZXJuJyxcclxuICAgICAgICAgICAgICAgIHBhdHRlcm46ICclbSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IFsnY29uc29sZSddXHJcbiAgICAgICAgfVxyXG4gICAgXSxcclxuICAgIHJlcGxhY2VDb25zb2xlOiB0cnVlXHJcbn0pO1xyXG5cclxuY29uc3QgcmV0dXJuX3N0YXR1cyA9IGZ1bmN0aW9uIChzdGF0dXM6IGFueSwgcmVxOiBhbnksIHJlczogYW55KSB7XHJcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgcmVzLnN0YXR1cyhzdGF0dXMuc3RhdHVzQ29kZSkuc2VuZChzdGF0dXMubWVzc2FnZSk7XHJcbn07XHJcblxyXG5jb25zdCByZXR1cm5fanNvbiA9IGZ1bmN0aW9uIChqc29uOiBhbnksIHJlcTogYW55LCByZXM6IGFueSkge1xyXG4gICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcclxuICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KGpzb24sIG51bGwsIDIpKTtcclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZV93b3JrZmxvd3NfZnJvbV9maWxlID0gZnVuY3Rpb24gKHJlcTogYW55LCByZXM6IGFueSkge1xyXG4gICAgd29ya2Zsb3dzLmNyZWF0ZV93b3JrZmxvd3NfZnJvbV9maWxlKHJlcSwgKGVycm9yOiBhbnksIGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChlcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpKTtcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5jb25zdCBkZWxldGVfd29ya2Zsb3cgPSBmdW5jdGlvbiAocmVxOiBhbnksIHJlczogYW55KSB7XHJcbiAgICB3b3JrZmxvd3MuZGVsZXRlX3dvcmtmbG93KHJlcS5wYXJhbXNbJ3dvcmtmbG93X2lkJ10sIChlcnJvcjogYW55LCBkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoZXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpKTtcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5jb25zdCBzZXRfbm9kZV9hdmFpbGFiaWxpdHkgPSBmdW5jdGlvbiAocmVxOiBhbnksIHJlczogYW55KSB7XHJcbiAgICBkb2NrZXIuc2V0X25vZGVfYXZhaWxhYmlsaXR5KHJlcS5wYXJhbXNbJ2hvc3RuYW1lJ10sIHJlcS5wYXJhbXNbJ2F2YWlsYWJpbGl0eSddLCAoZXJyb3I6IGFueSwgZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKGVycm9yKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuY29uc3Qgc3RhcnRfdmlydHVhbG1hY2hpbmUgPSBmdW5jdGlvbiAocmVxOiBhbnksIHJlczogYW55KSB7XHJcbiAgICBzY2FsaW5nLnN0YXJ0X3ZpcnR1YWxtYWNoaW5lKHJlcS5wYXJhbXNbJ3Jlc291cmNlZ3JvdXAnXSwgcmVxLnBhcmFtc1snbWFjaGluZV9pZCddLCAoZXJyb3I6IGFueSwgZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKGVycm9yKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuY29uc3Qgc3RvcF92aXJ0dWFsbWFjaGluZSA9IGZ1bmN0aW9uIChyZXE6IGFueSwgcmVzOiBhbnkpIHtcclxuICAgIHNjYWxpbmcuc3RvcF92aXJ0dWFsbWFjaGluZShyZXEucGFyYW1zWydyZXNvdXJjZWdyb3VwJ10sIHJlcS5wYXJhbXNbJ21hY2hpbmVfaWQnXSwgKGVycm9yOiBhbnksIGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChlcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMikpO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8vIFJPVVRJTkdcclxuY29uc3Qgc2V0dXBfcm91dGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgYXBwLmdldCgnL2FwaS9yZWRpcy9zdGF0dXMnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fc3RhdHVzKHJlZGlzLmNoZWNrX3N0YXR1cygpLCByZXEsIHJlcykpO1xyXG5cclxuICAgIGFwcC5nZXQoJy9hcGkvd29ya2Zsb3cvc3RhdHVzJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX3N0YXR1cyh3b3JrZmxvd3MuY2hlY2tfc3RhdHVzKCksIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAuZ2V0KCcvYXBpL3dvcmtmbG93L3dvcmtmbG93cycsIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHJldHVybl9qc29uKHdvcmtmbG93cy5nZXRfd29ya2Zsb3dzKCksIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAucG9zdCgnL2FwaS93b3JrZmxvdy93b3JrZmxvd3MnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbih3b3JrZmxvd3MuY3JlYXRlX3dvcmtmbG93KHJlcS5ib2R5KSwgcmVxLCByZXMpKTtcclxuICAgIGFwcC5kZWxldGUoJy9hcGkvd29ya2Zsb3cvd29ya2Zsb3dzJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX2pzb25fcG9zdCh3b3JrZmxvd3MuZGVsZXRlX2FsbF93b3JrZmxvd3MsIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAuZGVsZXRlKCcvYXBpL3dvcmtmbG93L3dvcmtmbG93cy86d29ya2Zsb3dfaWQnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiBkZWxldGVfd29ya2Zsb3cocmVxLCByZXMpKTtcclxuICAgIGFwcC5wb3N0KCcvYXBpL3dvcmtmbG93L3dvcmtmbG93cy9maWxlJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gY3JlYXRlX3dvcmtmbG93c19mcm9tX2ZpbGUocmVxLCByZXMpKTtcclxuXHJcbiAgICBhcHAuZ2V0KCcvYXBpL2RvY2tlci9zdGF0dXMnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fc3RhdHVzKGRvY2tlci5jaGVja19zdGF0dXMoKSwgcmVxLCByZXMpKTtcclxuICAgIGFwcC5nZXQoJy9hcGkvZG9ja2VyL2luZm8vcmVtb3RlJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX2pzb24oZG9ja2VyLmdldF9yZW1vdGVfaW5mbygpLCByZXEsIHJlcykpO1xyXG4gICAgYXBwLmdldCgnL2FwaS9kb2NrZXIvY29udGFpbmVycy9yZW1vdGUnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbihkb2NrZXIuZ2V0X3JlbW90ZV9jb250YWluZXJzKCksIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAuZ2V0KCcvYXBpL2RvY2tlci9zZXJ2aWNlcy9yZW1vdGUnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbihkb2NrZXIuZ2V0X3JlbW90ZV9zZXJ2aWNlcygpLCByZXEsIHJlcykpO1xyXG5cclxuICAgIGFwcC5wb3N0KCcvYXBpL2RvY2tlci9zZXJ2aWNlcy93b3JrZXJzJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX2pzb25fcG9zdChkb2NrZXIuY3JlYXRlX3dvcmtlcnMsIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAuZGVsZXRlKCcvYXBpL2RvY2tlci9zZXJ2aWNlcy93b3JrZXJzJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX2pzb25fcG9zdChkb2NrZXIuZGVsZXRlX3dvcmtlcnMsIHJlcSwgcmVzKSk7XHJcblxyXG4gICAgYXBwLmdldCgnL2FwaS9kb2NrZXIvbm9kZXMnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbihkb2NrZXIuZ2V0X25vZGVzKCksIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAucG9zdCgnL2FwaS9kb2NrZXIvbm9kZXMvOmhvc3RuYW1lLzphdmFpbGFiaWxpdHknLCBzZXRfbm9kZV9hdmFpbGFiaWxpdHkpO1xyXG5cclxuICAgIGFwcC5nZXQoJy9hcGkvZG9ja2VyL3dvcmtlcnMnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbihkb2NrZXIuZ2V0X3dvcmtlcnMoKSwgcmVxLCByZXMpKTtcclxuXHJcbiAgICBhcHAuZ2V0KCcvYXBpL2h1bWFuL3N0YXR1cycsIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHJldHVybl9zdGF0dXMoaHVtYW4uY2hlY2tfc3RhdHVzKCksIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAuZ2V0KCcvYXBpL2h1bWFuL2luZm8nLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbihodW1hbi5nZXRfaW5mbygpLCByZXEsIHJlcykpO1xyXG4gICAgYXBwLnBvc3QoJy9hcGkvaHVtYW4vc3RhcnQnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbl9wb3N0KGh1bWFuLnN0YXJ0X2h1bWFucywgcmVxLCByZXMpKTtcclxuICAgIGFwcC5wb3N0KCcvYXBpL2h1bWFuL3N0b3AnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbl9wb3N0KGh1bWFuLnN0b3BfaHVtYW5zLCByZXEsIHJlcykpO1xyXG5cclxuICAgIGFwcC5nZXQoJy9hcGkvc2NhbGluZy9zdGF0dXMnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fc3RhdHVzKHNjYWxpbmcuY2hlY2tfc3RhdHVzKCksIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAuZ2V0KCcvYXBpL3NjYWxpbmcvdmlydHVhbG1hY2hpbmVzJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX2pzb24oc2NhbGluZy5nZXRfdmlydHVhbG1hY2hpbmVzKCksIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAucG9zdCgnL2FwaS9zY2FsaW5nL3ZpcnR1YWxtYWNoaW5lcy86cmVzb3VyY2Vncm91cC86bWFjaGluZV9pZC9zdGFydCcsIHN0YXJ0X3ZpcnR1YWxtYWNoaW5lKTtcclxuICAgIGFwcC5wb3N0KCcvYXBpL3NjYWxpbmcvdmlydHVhbG1hY2hpbmVzLzpyZXNvdXJjZWdyb3VwLzptYWNoaW5lX2lkL3N0b3AnLCBzdG9wX3ZpcnR1YWxtYWNoaW5lKTtcclxuXHJcbiAgICBhcHAuZ2V0KCcvYXBpL3NjaGVkdWxlci9zdGF0dXMnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fc3RhdHVzKHNjaGVkdWxlci5jaGVja19zdGF0dXMoKSwgcmVxLCByZXMpKTtcclxuICAgIGFwcC5nZXQoJy9hcGkvc2NoZWR1bGVyL2luZm8nLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbihzY2hlZHVsZXIuZ2V0X2luZm8oKSwgcmVxLCByZXMpKTtcclxuICAgIGFwcC5nZXQoJy9hcGkvc2NoZWR1bGVyL3Rhc2tzL2h1bWFuJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX2pzb24oc2NoZWR1bGVyLmdldF9odW1hbl90YXNrcygpLCByZXEsIHJlcykpO1xyXG4gICAgYXBwLnBvc3QoJy9hcGkvc2NoZWR1bGVyL3Rhc2snLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbl9wb3N0KHNjaGVkdWxlci5zZXRfaHVtYW5fdGFzaywgcmVxLCByZXMpKTtcclxuICAgIGFwcC5wb3N0KCcvYXBpL3NjaGVkdWxlci9wb2xpY3knLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbihzY2hlZHVsZXIuc2V0X3BvbGljeShyZXEuYm9keSksIHJlcSwgcmVzKSk7XHJcbiAgICBhcHAucG9zdCgnL2FwaS9zY2hlZHVsZXIvYW1vdW50JywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX2pzb25fcG9zdChzY2hlZHVsZXIuc2V0X2Ftb3VudCwgcmVxLCByZXMpKTtcclxuICAgIGFwcC5wb3N0KCcvYXBpL3NjaGVkdWxlci9leGVjdXRlJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX2pzb25fcG9zdChzY2hlZHVsZXIuZXhlY3V0ZSwgcmVxLCByZXMpKTtcclxuXHJcbiAgICBhcHAuZ2V0KCcvYXBpL2VsYXN0aWMvc3RhdHVzJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4gcmV0dXJuX3N0YXR1cyhlbGFzdGljLmNoZWNrX3N0YXR1cygpLCByZXEsIHJlcykpO1xyXG4gICAgYXBwLmdldCgnL2FwaS9lbGFzdGljL2xvZ3MnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbihlbGFzdGljLmdldF9tZXNzYWdlcygpLCByZXEsIHJlcykpO1xyXG4gICAgYXBwLmdldCgnL2FwaS9lbGFzdGljL2xvYWQnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiByZXR1cm5fanNvbihlbGFzdGljLmdldF9sb2FkKCksIHJlcSwgcmVzKSk7XHJcbn07XHJcblxyXG5jb25zdCBzdGFydF9jaGVja19zdGF0dXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZWRpcy51cGRhdGVfc3RhdHVzKDIwMDApO1xyXG5cclxuICAgIHNjaGVkdWxlci5zdGFydF91cGRhdGVzKDIwMDApO1xyXG4gICAgd29ya2Zsb3dzLnN0YXJ0X3VwZGF0ZXMoMjAwMCk7XHJcbiAgICBkb2NrZXIuc3RhcnRfdXBkYXRlcygxMDAwMCk7IC8vIDEwc2VjIGZvciBkb2NrZXJcclxuICAgIGh1bWFuLnN0YXJ0X3VwZGF0ZXMoMjAwMCk7XHJcbiAgICBzY2FsaW5nLnN0YXJ0X3VwZGF0ZXMoMjAwMCk7XHJcbiAgICBlbGFzdGljLnN0YXJ0X3VwZGF0ZXMoMjAwMCk7XHJcbn07XHJcblxyXG4vLyBTZXJ2ZXIgc3RhcnR1cFxyXG5jb25zdCBzdGFydF9zZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBzZXJ2ZXIubGlzdGVuKDgwODAsICgpID0+IGNvbnNvbGUubG9nKCdFbGFzdGljLWRhc2hib2FyZC1hcGkgbGlzdGVuaW5nIG9uIHBvcnQgODA4MCEnKSk7XHJcbn07XHJcblxyXG4vLyBXaGVuIHJ1biBkaXJlY3RseSwgc2VydmUgdGhlIEFQSVxyXG5pZiAocmVxdWlyZS5tYWluID09PSBtb2R1bGUpIHtcclxuICAgIHNldHVwX3JvdXRlcygpO1xyXG4gICAgc3RhcnRfc2VydmVyKCk7XHJcbiAgICBzdGFydF9jaGVja19zdGF0dXMoKTtcclxufVxyXG4iXX0=
