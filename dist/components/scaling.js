/*jshint esversion: 6 */
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Scaling {
    constructor() {
        this.Client = require('node-rest-client').Client;
        this.client = new this.Client();
        this.scaling_host = process.env.SCALING_HOST || 'localhost';
        this.component = {};
        this.status = {
            message: 'not updated yet',
            statusCode: 500
        };
        this.virtualmachines = [];
    }
    start_updates(interval) {
        this.update_status(interval);
        this.update_virtualmachines(10 * interval);
    }
    update_status(interval) {
        const req = this.client.get('http://' + this.scaling_host + ':8888/status', (data, response) => {
            this.status.statusCode = response.statusCode;
            this.status.message = response.statusMessage;
            setTimeout(() => this.update_status(interval), interval);
        });
        req.on('error', (error) => {
            this.status.statusCode = 500;
            this.status.message = error.code;
            setTimeout(() => this.update_status(interval), interval);
        });
    }
    update_virtualmachines(interval) {
        const req = this.client.get('http://' + this.scaling_host + ':8888/virtualmachines', (data, response) => {
            this.virtualmachines = data;
            setTimeout(() => this.update_virtualmachines(interval), interval);
        });
        req.on('error', (error) => {
            console.log(error);
            this.status.statusCode = 500;
            this.status.message = error.code;
            setTimeout(() => this.update_virtualmachines(interval), interval);
        });
    }
    check_status() {
        return this.status;
    }
    ;
    get_virtualmachines() {
        return this.virtualmachines;
    }
    ;
    start_virtualmachine(resourcegroup, machine_id, cb) {
        const req = this.client.post('http://' + this.scaling_host + ':8888/virtualmachines/' + resourcegroup + '/' + machine_id, (data, response) => {
            if (response.statusCode === 200) {
                cb(null, data);
            }
            else {
                cb('Error: ' + data, null);
            }
        });
        req.on('error', (error) => {
            cb('error: ' + error, null);
        });
    }
    ;
    stop_virtualmachine(resourcegroup, machine_id, cb) {
        const req = this.client.delete('http://' + this.scaling_host + ':8888/virtualmachines/' + resourcegroup + '/' + machine_id, (data, response) => {
            if (response.statusCode === 200) {
                cb(null, data);
            }
            else {
                cb('Error: ' + data, null);
            }
        });
        req.on('error', (error) => {
            cb('error: ' + error, null);
        });
    }
    ;
}
exports.Scaling = Scaling;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRzL3NjYWxpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsd0JBQXdCOzs7QUFFeEI7SUFBQTtRQUNJLFdBQU0sR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDNUMsV0FBTSxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzNCLGlCQUFZLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLElBQUksV0FBVyxDQUFDO1FBQ3ZELGNBQVMsR0FBRyxFQUFFLENBQUM7UUFDZixXQUFNLEdBQUc7WUFDTCxPQUFPLEVBQUUsaUJBQWlCO1lBQzFCLFVBQVUsRUFBRSxHQUFHO1NBQ2xCLENBQUM7UUFDRixvQkFBZSxHQUFVLEVBQUUsQ0FBQztJQTZFaEMsQ0FBQztJQTNFRyxhQUFhLENBQUMsUUFBYTtRQUN2QixJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVELGFBQWEsQ0FBQyxRQUFhO1FBQ3ZCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxHQUFHLGNBQWMsRUFDdEUsQ0FBQyxJQUFTLEVBQUUsUUFBYTtZQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUMsVUFBVSxDQUFDO1lBQzdDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUM7WUFFN0MsVUFBVSxDQUFDLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUMsQ0FBQztRQUVQLEdBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBVTtZ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QyxDQUFDO1lBQy9CLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVQLEdBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBVTtZQUN2QixFQUFFLENBQUMsU0FBUyxHQUFHLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFBQSxDQUFDO0NBQ0w7QUF0RkQsMEJBc0ZDIiwiZmlsZSI6ImNvbXBvbmVudHMvc2NhbGluZy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qanNoaW50IGVzdmVyc2lvbjogNiAqL1xyXG5cclxuZXhwb3J0IGNsYXNzIFNjYWxpbmcge1xyXG4gICAgQ2xpZW50ID0gcmVxdWlyZSgnbm9kZS1yZXN0LWNsaWVudCcpLkNsaWVudDtcclxuICAgIGNsaWVudCA9IG5ldyB0aGlzLkNsaWVudCgpO1xyXG4gICAgc2NhbGluZ19ob3N0ID0gcHJvY2Vzcy5lbnYuU0NBTElOR19IT1NUIHx8ICdsb2NhbGhvc3QnO1xyXG4gICAgY29tcG9uZW50ID0ge307XHJcbiAgICBzdGF0dXMgPSB7XHJcbiAgICAgICAgbWVzc2FnZTogJ25vdCB1cGRhdGVkIHlldCcsXHJcbiAgICAgICAgc3RhdHVzQ29kZTogNTAwXHJcbiAgICB9O1xyXG4gICAgdmlydHVhbG1hY2hpbmVzOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgIHN0YXJ0X3VwZGF0ZXMoaW50ZXJ2YWw6IGFueSkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlX3N0YXR1cyhpbnRlcnZhbCk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVfdmlydHVhbG1hY2hpbmVzKDEwICogaW50ZXJ2YWwpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZV9zdGF0dXMoaW50ZXJ2YWw6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHJlcSA9IHRoaXMuY2xpZW50LmdldCgnaHR0cDovLycgKyB0aGlzLnNjYWxpbmdfaG9zdCArICc6ODg4OC9zdGF0dXMnLFxyXG4gICAgICAgICAgICAoZGF0YTogYW55LCByZXNwb25zZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cy5zdGF0dXNDb2RlID0gcmVzcG9uc2Uuc3RhdHVzQ29kZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzLm1lc3NhZ2UgPSByZXNwb25zZS5zdGF0dXNNZXNzYWdlO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy51cGRhdGVfc3RhdHVzKGludGVydmFsKSwgaW50ZXJ2YWwpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVxLm9uKCdlcnJvcicsIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzLnN0YXR1c0NvZGUgPSA1MDA7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzLm1lc3NhZ2UgPSBlcnJvci5jb2RlO1xyXG5cclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnVwZGF0ZV9zdGF0dXMoaW50ZXJ2YWwpLCBpbnRlcnZhbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlX3ZpcnR1YWxtYWNoaW5lcyhpbnRlcnZhbDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgcmVxID0gdGhpcy5jbGllbnQuZ2V0KCdodHRwOi8vJyArIHRoaXMuc2NhbGluZ19ob3N0ICsgJzo4ODg4L3ZpcnR1YWxtYWNoaW5lcycsXHJcbiAgICAgICAgICAgIChkYXRhOiBhbnksIHJlc3BvbnNlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlydHVhbG1hY2hpbmVzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy51cGRhdGVfdmlydHVhbG1hY2hpbmVzKGludGVydmFsKSwgaW50ZXJ2YWwpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVxLm9uKCdlcnJvcicsIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgICAgICAgdGhpcy5zdGF0dXMuc3RhdHVzQ29kZSA9IDUwMDtcclxuICAgICAgICAgICAgdGhpcy5zdGF0dXMubWVzc2FnZSA9IGVycm9yLmNvZGU7XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMudXBkYXRlX3ZpcnR1YWxtYWNoaW5lcyhpbnRlcnZhbCksIGludGVydmFsKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja19zdGF0dXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdHVzO1xyXG4gICAgfTtcclxuXHJcbiAgICBnZXRfdmlydHVhbG1hY2hpbmVzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZpcnR1YWxtYWNoaW5lcztcclxuICAgIH07XHJcblxyXG4gICAgc3RhcnRfdmlydHVhbG1hY2hpbmUocmVzb3VyY2Vncm91cDogYW55LCBtYWNoaW5lX2lkOiBhbnksIGNiOiBhbnkpIHtcclxuICAgICAgICBjb25zdCByZXEgPSB0aGlzLmNsaWVudC5wb3N0KCdodHRwOi8vJyArIHRoaXMuc2NhbGluZ19ob3N0ICsgJzo4ODg4L3ZpcnR1YWxtYWNoaW5lcy8nICsgcmVzb3VyY2Vncm91cCArICcvJyArIG1hY2hpbmVfaWQsXHJcbiAgICAgICAgICAgIChkYXRhOiBhbnksIHJlc3BvbnNlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2IoJ0Vycm9yOiAnICsgZGF0YSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXEub24oJ2Vycm9yJywgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY2IoJ2Vycm9yOiAnICsgZXJyb3IsIG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBzdG9wX3ZpcnR1YWxtYWNoaW5lKHJlc291cmNlZ3JvdXA6IGFueSwgbWFjaGluZV9pZDogYW55LCBjYjogYW55KSB7XHJcbiAgICAgICAgY29uc3QgcmVxID0gdGhpcy5jbGllbnQuZGVsZXRlKCdodHRwOi8vJyArIHRoaXMuc2NhbGluZ19ob3N0ICsgJzo4ODg4L3ZpcnR1YWxtYWNoaW5lcy8nICsgcmVzb3VyY2Vncm91cCArICcvJyArIG1hY2hpbmVfaWQsXHJcbiAgICAgICAgICAgIChkYXRhOiBhbnksIHJlc3BvbnNlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2IoJ0Vycm9yOiAnICsgZGF0YSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXEub24oJ2Vycm9yJywgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY2IoJ2Vycm9yOiAnICsgZXJyb3IsIG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxufVxyXG4iXX0=
